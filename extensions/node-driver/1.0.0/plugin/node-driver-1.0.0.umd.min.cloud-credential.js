(("undefined"!==typeof self?self:this)["webpackJsonpnode_driver_1_0_0"]=("undefined"!==typeof self?self:this)["webpackJsonpnode_driver_1_0_0"]||[]).push([[1],{"12f0":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"row"},[a("div",{staticClass:"col span-6"},[a("LabeledInput",{attrs:{value:t.value.decodedData.endpoint,disabled:1!==t.step,"label-key":"driver.openstack.auth.fields.endpoint","placeholder-key":"driver.openstack.auth.placeholders.endpoint",type:"text",mode:t.mode},on:{input:function(e){return t.value.setData("endpoint",e)}}})],1),a("div",{staticClass:"col span-6"},[a("LabeledInput",{attrs:{value:t.value.decodedData.domainName,disabled:1!==t.step,"label-key":"driver.openstack.auth.fields.domainName","placeholder-key":"driver.openstack.auth.placeholders.domainName",type:"text",mode:t.mode},on:{input:function(e){return t.value.setData("domainName",e)}}})],1)]),a("div",{staticClass:"row"},[a("div",{staticClass:"col span-6"},[a("LabeledInput",{staticClass:"mt-20",attrs:{value:t.value.decodedData.username,disabled:1!==t.step,"label-key":"driver.openstack.auth.fields.username","placeholder-key":"driver.openstack.auth.placeholders.username",type:"text",mode:t.mode},on:{input:function(e){return t.value.setData("username",e)}}})],1),a("div",{staticClass:"col span-6"},[a("LabeledInput",{staticClass:"mt-20",attrs:{value:t.value.decodedData.password,disabled:1!==t.step,"label-key":"driver.openstack.auth.fields.password","placeholder-key":"driver.openstack.auth.placeholders.password",type:"password",mode:t.mode},on:{input:function(e){return t.value.setData("password",e)}}})],1)]),a("BusyButton",{ref:"connect",staticClass:"mt-20",attrs:{"label-key":"driver.openstack.auth.actions.authenticate",disabled:1!==t.step||!t.canAuthenticate},on:{click:t.connect}}),a("button",{staticClass:"btn role-primary mt-20 ml-20",attrs:{disabled:t.busy||1===t.step},on:{click:t.clear}},[t._v(" "+t._s(t.t("driver.openstack.auth.actions.edit"))+" ")]),t.error?a("Banner",{staticClass:"mt-20",attrs:{color:"error"}},[t._v(" "+t._s(t.error)+" ")]):t._e(),t.errorAllowHost?a("Banner",{staticClass:"allow-list-error",attrs:{color:"error"}},[a("div",[t._v(" "+t._s(t.t("driver.openstack.auth.errors.notAllowed",{hostname:t.hostname}))+" ")]),a("button",{staticClass:"btn ml-10 role-primary",attrs:{disabled:t.allowBusy},on:{click:t.addHostToAllowList}},[t._v(" "+t._s(t.t("driver.openstack.auth.actions.addToAllowList"))+" ")])]):t._e(),t.projects?a("div",{staticClass:"row mt-20"},[a("div",{staticClass:"col span-6"},[a("LabeledSelect",{attrs:{"label-key":"driver.openstack.auth.fields.project",options:t.projectOptions,searchable:!1},model:{value:t.project,callback:function(e){t.project=e},expression:"project"}})],1)]):t._e()],1)},o=[],i=a("eb32"),n=a("8e93"),r=a("466b");function d(t){const e=d.options,a=e.parser[e.strictMode?"strict":"loose"].exec(t);if(!a)throw new Error("Cannot parse as uri: "+t);const s={};let o=14;while(o--)s[e.key[o]]=a[o]||"";return s.query={},s.queryStr.replace(e.q.parser,(t,a,o)=>(a&&(s[e.q.name][a]=o),"")),s}d.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","queryStr","anchor"],q:{name:"query",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var l=a("da25"),c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("button",{ref:"btn",staticClass:"btn role-primary",attrs:{disabled:t.disabled,"tab-index":t.tabIndex,"data-testid":t.componentTestid+"-async-button"},on:{click:t.clicked}},[t.busy?a("i",{staticClass:"icon icon-lg icon-spinner icon-spin"}):a("span",{staticClass:"icon-spacer"}),a("span",[t._v(t._s(t.displayLabel))]),a("span",{staticClass:"icon-spacer"})])},p=[],u=a("8bbf"),h=a.n(u),v=h.a.extend({props:{label:{type:String,default:void 0},labelKey:{type:String,default:void 0},disabled:{type:Boolean,default:!1},tabIndex:{type:Number,default:null},componentTestid:{type:String,default:"busy-button"},manual:{type:Boolean,default:!1}},data(){return{busy:!1}},computed:{displayLabel(){if(this.labelKey){const t=this.$store.getters["i18n/t"];return t(this.labelKey)}return this.label}},methods:{clicked(t){if(t&&(t.stopPropagation(),t.preventDefault()),this.disabled)return;const e=()=>{this.busy=!1};this.$set(this,"busy",!0),this.$emit("click",e)},focus(){this.$refs.btn.focus()}}}),m=v,b=(a("d94d"),a("d802")),y=Object(b["a"])(m,c,p,!1,null,"60507a65",null),f=y.exports,w=a("f2d8"),k={components:{Banner:i["a"],BusyButton:f,LabeledInput:n["a"],LabeledSelect:r["a"]},props:{mode:{type:String,required:!0},value:{type:Object,required:!0}},async fetch(){this.driver=await this.$store.dispatch("rancher/find",{type:"nodedriver",id:"openstack"})},data(){return this.mode!==l["a"]&&(this.value.decodedData.username=this.value.annotations["openstack.cattle.io/username"],this.value.decodedData.domainName=this.value.annotations["openstack.cattle.io/domainName"],this.value.decodedData.endpoint=this.value.annotations["openstack.cattle.io/endpoint"]),{projects:null,step:1,busy:!1,project:"",errorAllowHost:!1,driver:{},allowBusy:!1,error:""}},computed:{projectOptions(){const t=(this.projects||[]).sort((t,e)=>t.name.localeCompare(e.name));return t.map(t=>({label:t.name,value:t.id}))},hostname(){const t=d(this.value.decodedData.endpoint);return(null===t||void 0===t?void 0:t.host)||""},canAuthenticate(){var t,e,a,s,o,i,n,r;return!(null===(t=this.value)||void 0===t||null===(e=t.decodedData)||void 0===e||!e.endpoint)&&!(null===(a=this.value)||void 0===a||null===(s=a.decodedData)||void 0===s||!s.domainName)&&!(null===(o=this.value)||void 0===o||null===(i=o.decodedData)||void 0===i||!i.username)&&!(null===(n=this.value)||void 0===n||null===(r=n.decodedData)||void 0===r||!r.password)}},created(){this.$emit("validationChanged",!1)},methods:{test(){this.value.annotations["openstack.cattle.io/username"]=this.value.decodedData.username,this.value.annotations["openstack.cattle.io/domainName"]=this.value.decodedData.domainName,this.value.annotations["openstack.cattle.io/endpoint"]=this.value.decodedData.endpoint;const t=this.projects.find(t=>t.id===this.project);return t&&(this.value.annotations["openstack.cattle.io/projectName"]=t.name,this.value.annotations["openstack.cattle.io/projectId"]=t.id,this.value.annotations["openstack.cattle.io/projectDomainName"]=t.domain_id),!0},clear(){this.$set(this,"step",1),this.$set(this,"projects",null),this.$set(this,"errorAllowHost",!1),this.$emit("validationChanged",!1)},hostInAllowList(){var t,e;if(null===(t=this.driver)||void 0===t||!t.whitelistDomains)return!1;const a=d(this.value.decodedData.endpoint);return!a.host||((null===(e=this.driver)||void 0===e?void 0:e.whitelistDomains)||[]).includes(a.host)},async addHostToAllowList(){this.$set(this,"allowBusy",!0);const t=d(this.value.decodedData.endpoint);this.driver.whitelistDomains=this.driver.whitelistDomains||[],this.hostInAllowList()||this.driver.whitelistDomains.push(t.host);try{await this.driver.save(),this.$refs.connect.$el.click()}catch(e){console.error("Could not update driver",e),this.$set(this,"allowBusy",!1)}},async connect(t){var e;this.$set(this,"error",""),this.$set(this,"errorAllowHost",!1);let a=!1;if(!this.value.decodedData.endpoint)return t(a);const s=new w["a"](this.$store,{endpoint:this.value.decodedData.endpoint,domainName:this.value.decodedData.domainName,username:this.value.decodedData.username,password:this.value.decodedData.password});this.$set(this,"allowBusy",!1),this.$set(this,"step",2),this.$set(this,"busy",!0);const o=await s.getToken();if(o.error)console.error(o.error),a=!1,this.$set(this,"step",1),this.$set(this,"projects",null),502!==o.error._status||this.hostInAllowList()?this.$set(this,"error",o.error.message):this.$set(this,"errorAllowHost",!0);else{const t=await s.getProjects();t.error?this.$set(this,"error",o.error.message):(this.$set(this,"projects",t),a=!0)}this.$set(this,"busy",!1),this.$set(this,"project",null===(e=this.projectOptions[0])||void 0===e?void 0:e.value),this.$emit("validationChanged",a),t(a)}}},g=k,x=(a("8933"),Object(b["a"])(g,s,o,!1,null,"64bdc33a",null));e["default"]=x.exports},1459:function(t,e,a){var s=a("5eaa");e=s(!1),e.push([t.i,'.clearfix[data-v-60507a65]:after,.clearfix[data-v-60507a65]:before{content:" ";display:table}.clearfix[data-v-60507a65]:after{clear:both}.list-unstyled[data-v-60507a65]{margin:0;padding:0;list-style-type:none}.no-select[data-v-60507a65]{-webkit-user-select:none;-moz-user-select:none;user-select:none}.no-resize[data-v-60507a65]{resize:none}.hand[data-v-60507a65]{cursor:pointer;cursor:hand}.fixed[data-v-60507a65]{table-layout:fixed}.clip[data-v-60507a65]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.clip[data-v-60507a65],.force-wrap[data-v-60507a65]{word-wrap:break-word}.force-wrap[data-v-60507a65]{white-space:normal}.bordered-section[data-v-60507a65]{border-bottom:1px solid var(--border);margin-bottom:20px;padding-bottom:20px}.section-divider[data-v-60507a65]{margin-bottom:20px;margin-top:20px}.icon-spacer[data-v-60507a65]{width:24px}',""]),t.exports=e},"757b":function(t,e,a){var s=a("ce50");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var o=a("0ed3").default;o("6aa29c23",s,!0,{sourceMap:!1,shadowMode:!1})},8933:function(t,e,a){"use strict";a("757b")},c763:function(t,e,a){var s=a("1459");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var o=a("0ed3").default;o("4ed41120",s,!0,{sourceMap:!1,shadowMode:!1})},ce50:function(t,e,a){var s=a("5eaa");e=s(!1),e.push([t.i,'.clearfix[data-v-64bdc33a]:after,.clearfix[data-v-64bdc33a]:before{content:" ";display:table}.clearfix[data-v-64bdc33a]:after{clear:both}.list-unstyled[data-v-64bdc33a]{margin:0;padding:0;list-style-type:none}.no-select[data-v-64bdc33a]{-webkit-user-select:none;-moz-user-select:none;user-select:none}.no-resize[data-v-64bdc33a]{resize:none}.hand[data-v-64bdc33a]{cursor:pointer;cursor:hand}.fixed[data-v-64bdc33a]{table-layout:fixed}.clip[data-v-64bdc33a]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.clip[data-v-64bdc33a],.force-wrap[data-v-64bdc33a]{word-wrap:break-word}.force-wrap[data-v-64bdc33a]{white-space:normal}.bordered-section[data-v-64bdc33a]{border-bottom:1px solid var(--border);margin-bottom:20px;padding-bottom:20px}.section-divider[data-v-64bdc33a]{margin-bottom:20px;margin-top:20px}.allow-list-error[data-v-64bdc33a]{display:flex}.allow-list-error[data-v-64bdc33a]>:first-child{flex:1}',""]),t.exports=e},d94d:function(t,e,a){"use strict";a("c763")},f2d8:function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));class s{constructor(t,e){this.domainName="",this.endpoint="",this.projectDomainName="",this.projectId="",this.projectName="",this.username="",this.password="",this.token="",this.userId="",e.annotations?Object.keys(e.annotations).forEach(t=>{const a=t.split("/");if(2===a.length&&"openstack.cattle.io"===a[0]){const s=a[1];this[s]=e.annotations[t]}}):Object.keys(e).forEach(t=>{this[t]=e[t]}),this.$dispatch=t.dispatch}async getToken(){const t=this.endpoint.replace(/^https?:\/\//,""),e="/meta/proxy/"+t,a=e+"/auth/tokens",s={auth:{identity:{methods:["password"],password:{user:{name:this.username,domain:{name:this.domainName},password:this.password}}}}};this.projectName&&(s.auth.scope={project:{name:this.projectName,domain:{name:this.projectDomainName}}});const o={Accept:"application/json"};try{var i,n;const t=await this.$dispatch("management/request",{url:a,headers:o,method:"POST",redirectUnauthorized:!1,data:s},{root:!0});if(502===t._status)return{error:"Could not proxy request - URL may not be in Rancher's allow list"};const e=t._headers["x-subject-token"];return this.token=e,this.userId=null===t||void 0===t||null===(i=t.token)||void 0===i||null===(n=i.user)||void 0===n?void 0:n.id,s.auth.scope&&null!==t&&void 0!==t&&t.token&&(this.catalog=t.token.catalog,this.endpoints={},this.catalog.forEach(t=>{const e=t.endpoints.find(t=>"public"===t.interface);e&&(this.endpoints[t.type]=e.url)})),t}catch(r){return console.error(r),{error:r}}}async getFlavors(t,e){return await this.getOptions(t,"/flavors","flavors",void 0,e)}async getImages(t,e){return await this.getOptions(t,"/images/detail","images",void 0,e)}async getKeyPairs(t,e){return await this.getOptions(t,"/os-keypairs","keypairs",t=>t.keypair,e)}async getSecurityGroups(t,e){return await this.getOptions(t,"/os-security-groups","security_groups",void 0,e)}async getFloatingIpPools(t,e){return await this.getOptions(t,"/os-floating-ip-pools","floating_ip_pools",void 0,e)}async getNetworkNames(t,e){return await this.getOptions(t,"/os-tenant-networks","networks",t=>({...t,name:t.label}),e)}async getAvailabilityZones(t,e){return await this.getOptions(t,"/os-availability-zone","availabilityZoneInfo",t=>({...t,name:t.zoneName}),e)}async getOptions(t,e,a,s,o){t.busy=!0,t.enabled=!0,t.selected="";const i=await this.makeComputeRequest(e);if(i&&i[a]){let e=i[a]||[];if(s&&(e=e.map(t=>s(t))),t.options=this.convertToOptions(e),t.busy=!1,o){const e=t.options.find(t=>t.value.name===o);e&&(t.selected=e.value)}!t.selected&&t.options.length>0&&(t.selected=t.options[0].value)}else t.options=[],t.selected=null,t.busy=!1,t.enabled=!1}async makeComputeRequest(t){const e=this.endpoints["compute"].replace(/^https?:\/\//,""),a="/meta/proxy/"+e,s=`${a}${t}`,o={Accept:"application/json","X-Auth-Token":this.token};try{const t=await this.$dispatch("management/request",{url:s,headers:o,method:"GET",redirectUnauthorized:!1},{root:!0});return t}catch(i){console.error(i)}}async getProjects(){const t=this.endpoint.replace(/^https?:\/\//,""),e="/meta/proxy/"+t,a={Accept:"application/json","X-Auth-Token":this.token};try{const t=await this.$dispatch("management/request",{url:`${e}/users/${this.userId}/projects`,headers:a,method:"GET",redirectUnauthorized:!1},{root:!0});return null===t||void 0===t?void 0:t.projects}catch(s){return console.error(s),{error:s}}}convertToOptions(t){const e=(t||[]).sort((t,e)=>t.name.localeCompare(e.name));return e.map(t=>({label:t.name,value:t}))}}}}]);
//# sourceMappingURL=node-driver-1.0.0.umd.min.cloud-credential.js.map